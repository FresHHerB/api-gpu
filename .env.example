# ============================================
# ORCHESTRATOR (VPS - Easypanel)
# ============================================

# Server Configuration
PORT=3000
NODE_ENV=production

# API Keys
X_API_KEY=sua-chave-publica-para-clientes

# ============================================
# RunPod Serverless Configuration
# ============================================

# RunPod API Key (get from https://runpod.io/console/user/settings)
RUNPOD_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxx

# RunPod Endpoint ID (created after deploying worker to RunPod)
# Current deployment (v2.11.0 - Fixed): 602eqftho5lspy
# See RUNPOD_DEPLOYMENT.md for details
RUNPOD_ENDPOINT_ID=602eqftho5lspy

# ============================================
# Timeout Configuration (30 min execution)
# ============================================

# Polling timeout - max attempts for job status polling
# 240 attempts × 8s max delay = 1920s = 32 min
POLLING_MAX_ATTEMPTS=240

# Express server timeout (milliseconds)
# 2100000ms = 35 min (3 min margin after polling)
EXPRESS_TIMEOUT_MS=2100000

# RunPod worker execution timeout (seconds)
# 2400s = 40 min (5 min margin after Express)
RUNPOD_EXECUTION_TIMEOUT=2400

# Worker idle timeout (seconds) - keep worker alive after job
RUNPOD_IDLE_TIMEOUT=300

# ============================================
# Logging
# ============================================

LOG_LEVEL=info  # debug, info, warn, error
LOGS_DIR=./logs

# ============================================
# Rate Limiting
# ============================================

RATE_LIMIT_WINDOW_MS=900000  # 15 minutos
RATE_LIMIT_MAX_REQUESTS=20

# ============================================
# CORS
# ============================================

CORS_ALLOW_ORIGINS=*  # ou domínios específicos separados por vírgula

# ============================================
# WORKER (RunPod Serverless)
# ============================================

# Worker Configuration (configuradas no template RunPod)
# WORK_DIR=/tmp/work
# OUTPUT_DIR=/tmp/output
# LOGS_DIR=/app/logs
# NODE_ENV=production
# PORT=8080

# Batch Processing Configuration
# BATCH_SIZE=3  # Número de imagens processadas em paralelo (padrão: 3)

# ============================================
# QUEUE SYSTEM CONFIGURATION
# ============================================

# Storage: "memory" for development, "redis" for production
QUEUE_STORAGE=memory

# Redis Configuration (if QUEUE_STORAGE=redis)
REDIS_URL=redis://localhost:6379

# Queue Settings
QUEUE_MAX_WORKERS=3                    # Maximum concurrent workers (RunPod limit)
QUEUE_POLLING_INTERVAL=5000            # Polling interval in ms (5 seconds)
QUEUE_TIMEOUT_CHECK_INTERVAL=60000     # Timeout check interval in ms (60 seconds)
QUEUE_JOB_TTL=86400                    # Job TTL in seconds (24 hours)

# ============================================
# WEBHOOK CONFIGURATION
# ============================================

WEBHOOK_MAX_RETRIES=3
WEBHOOK_RETRY_DELAYS=1000,5000,15000   # Delays in ms (exponential backoff)
WEBHOOK_SECRET=your-webhook-secret-for-hmac-signature

# ============================================
# S3 CONFIGURATION (for video/file storage)
# ============================================

AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_REGION=us-east-1
S3_BUCKET_NAME=your-bucket-name
S3_ENDPOINT=https://s3.amazonaws.com

# ============================================
# DESENVOLVIMENTO LOCAL
# ============================================
# Para testar worker localmente sem RunPod:

# WORK_DIR=./tmp/work
# OUTPUT_DIR=./tmp/output
# BATCH_SIZE=2
# AUTO_CLEANUP_TEMP_FILES=true
# TEMP_FILE_MAX_AGE_HOURS=24
