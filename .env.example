# ============================================
# ORCHESTRATOR (VPS - Easypanel)
# ============================================

# Server Configuration
PORT=3000
NODE_ENV=production

# API Keys
X_API_KEY=sua-chave-publica-para-clientes

# ============================================
# RunPod Serverless Configuration
# ============================================

# RunPod API Key (get from https://runpod.io/console/user/settings)
RUNPOD_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxx

# RunPod Endpoint ID (created after deploying worker to RunPod)
# Current deployment (v1.0.1 - RUNPOD_CPU_COUNT detection): us4twytbv2exzq
RUNPOD_ENDPOINT_ID=xxxxxxxxxx

# Whisper Transcription Endpoints
RUNPOD_WHISPER_ENDPOINT_ID=xxxxxxxxxx          # faster-whisper (runpod-workers/worker-faster_whisper)
RUNPOD_WHISPER_OFFICIAL_ENDPOINT_ID=xxxxxxxxxx  # OpenAI Whisper Official (FresHHerB/whisper-hub)

# ============================================
# Timeout Configuration (30 min execution)
# ============================================

# Polling timeout - max attempts for job status polling
# 240 attempts × 8s max delay = 1920s = 32 min
POLLING_MAX_ATTEMPTS=240

# Express server timeout (milliseconds)
# 2100000ms = 35 min (3 min margin after polling)
EXPRESS_TIMEOUT_MS=2100000

# RunPod worker execution timeout (seconds)
# 2400s = 40 min (5 min margin after Express)
RUNPOD_EXECUTION_TIMEOUT=2400

# Worker idle timeout (seconds) - keep worker alive after job
RUNPOD_IDLE_TIMEOUT=120

# ============================================
# Worker Configuration
# ============================================

# Batch size - número de imagens processadas em paralelo
# Calculated dynamically by worker based on container CPU quota
BATCH_SIZE=5

# ============================================
# S3/MinIO Configuration (Worker Upload)
# ============================================

S3_ENDPOINT_URL=https://minio.automear.com
S3_LOCAL_URL=https://minio.automear.com
S3_ACCESS_KEY=your-s3-access-key
S3_SECRET_KEY=your-s3-secret-key
S3_BUCKET_NAME=your-bucket-name
S3_REGION=us-east-1

# ============================================
# Logging
# ============================================

LOG_LEVEL=info  # debug, info, warn, error
LOGS_DIR=./logs

# ============================================
# Rate Limiting
# ============================================

RATE_LIMIT_WINDOW_MS=900000  # 15 minutos
RATE_LIMIT_MAX_REQUESTS=20

# ============================================
# CORS
# ============================================

CORS_ALLOW_ORIGINS=*  # ou domínios específicos separados por vírgula

# ============================================
# WORKER (RunPod Serverless)
# ============================================

# Worker Configuration (configured in RunPod template)
# WORK_DIR=/tmp/work
# OUTPUT_DIR=/tmp/output
# HTTP_PORT=8000

# ============================================
# QUEUE SYSTEM CONFIGURATION
# ============================================

# Storage: "memory" for development, "redis" for production
QUEUE_STORAGE=memory

# Redis Configuration (if QUEUE_STORAGE=redis)
REDIS_URL=redis://localhost:6379

# Queue Settings
QUEUE_MAX_WORKERS=3                    # Maximum concurrent workers (RunPod limit)
QUEUE_POLLING_INTERVAL=5000            # Polling interval in ms (5 seconds)
QUEUE_TIMEOUT_CHECK_INTERVAL=60000     # Timeout check interval in ms (60 seconds)
QUEUE_JOB_TTL=86400                    # Job TTL in seconds (24 hours)

# ============================================
# WEBHOOK CONFIGURATION
# ============================================

WEBHOOK_MAX_RETRIES=3
WEBHOOK_RETRY_DELAYS=1000,5000,15000   # Delays in ms (exponential backoff)
WEBHOOK_SECRET=your-webhook-secret-for-hmac-signature

# ============================================
# VPS LOCAL WORKER CONFIGURATION
# ============================================

# Maximum concurrent jobs for VPS local processing
VPS_MAX_CONCURRENT_JOBS=2

# ============================================
# YOUTUBE TRANSCRIPT SERVICE (Playwright)
# ============================================

# Browser Pool Configuration
BROWSER_POOL_SIZE=3                # Number of browsers in pool (default: 3)
MAX_CONTEXTS_PER_BROWSER=5         # Max contexts per browser (default: 5)

# Redis Cache Configuration (optional - improves performance)
# Option 1: Complete connection string (PREFERRED)
REDIS_URL=redis://default:password@host:6379

# Option 2: Individual variables (fallback if REDIS_URL not set)
# REDIS_HOST=localhost
# REDIS_PORT=6379
# REDIS_PASSWORD=
# REDIS_DB=0

# ============================================
# DESENVOLVIMENTO LOCAL
# ============================================
# Para testar worker localmente sem RunPod:

# WORK_DIR=./tmp/work
# OUTPUT_DIR=./tmp/output
# BATCH_SIZE=2
# AUTO_CLEANUP_TEMP_FILES=true
# TEMP_FILE_MAX_AGE_HOURS=24
